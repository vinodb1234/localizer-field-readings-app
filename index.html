<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Localizer Field Readings</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>

  <div class="topbar">
    <div class="topbar-row">
      <div class="title">Localizer Field Readings</div>
      <div>
        <button id="btnHome" class="btn small">Home</button>
      </div>
    </div>
  </div>

  <!-- PAGE 1: BASIC DETAILS -->
  <div id="page-meta" class="page">
    <div class="container">
      <div class="card">
        <h2>Basic Details</h2>
        <div class="row">
          <label>Station Code <input id="station" placeholder="VOBM"></label>
          <label>Frequency (MHz) <input id="freq" placeholder="110.50"></label>
          <label>Make <input id="make" placeholder="e.g. Rohde&Schwarz"></label>
          <label>Model <input id="model" placeholder="e.g. XYZ"></label>
          <label>Ref Date (DD-MM-YYYY) <input id="refDate" placeholder="DD-MM-YYYY"></label>
          <label>Pres Date (DD-MM-YYYY) <input id="presDate" placeholder="DD-MM-YYYY"></label>
          <label>Course Width (°) <input id="course" placeholder="e.g. 3"></label>
        </div>
      </div>

      <div class="actions" style="margin-top:6px">
        <button id="clearAll" class="btn danger">Clear Saved Data</button>
      </div>

      <div style="height:16px"></div>

      <div style="position:sticky; bottom:12px; padding:10px; background:transparent">
        <button id="metaNext" class="btn primary" style="width:100%; padding:14px; font-size:16px">NEXT — Choose Readings</button>
      </div>
    </div>
  </div>

  <!-- PAGE 2: STAGE DASHBOARD -->
  <div id="page-stage" class="page hidden">
    <div class="container">
      <div class="card">
        <h2>Dashboard</h2>
        <div class="stage-row">
          <button id="choosePresent" class="stage-btn">Present Readings</button>
          <button id="chooseReference" class="stage-btn">Reference Readings</button>
          <button id="chooseResults" class="stage-btn" style="display:none" title="View Results & Graphs">Results & Graphs</button>
        </div>
        <div class="note" id="stageProgress"></div>
      </div>
    </div>
  </div>

  <!-- PAGE 3: TX SELECTION -->
  <div id="page-txselect" class="page hidden">
    <div class="container">
      <div class="card">
        <h2>Select Transmitter — <span id="txselectHeader"></span></h2>
        <div class="tx-card-row">
          <div id="tx1Card" class="tx-card" data-tx="tx1" role="button">
            <div class="tx-card-title">TX1</div>
            <div class="tx-card-sub">Transmitter A</div>
            <div class="tx-card-foot" id="tx1Status"></div>
          </div>
          <div id="tx2Card" class="tx-card" data-tx="tx2" role="button">
            <div class="tx-card-title">TX2</div>
            <div class="tx-card-sub">Transmitter B</div>
            <div class="tx-card-foot" id="tx2Status"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE 4: ANGLE DIRECTION -->
  <div id="page-direction" class="page hidden">
    <div class="container">
      <div class="card">
        <h2 id="dirHeader">Select Angle Direction</h2>
        <div class="row" style="align-items:center">
          <label style="min-width:unset"><input type="radio" name="angleDir" id="dirNeg2Pos" value="neg2pos"> -35 → +35</label>
          <label style="min-width:unset"><input type="radio" name="angleDir" id="dirPos2Neg" value="pos2neg"> +35 → -35</label>
        </div>
        <div class="actions">
          <button id="dirContinue" class="btn primary">Continue</button>
          <button id="dirBack" class="btn">Back</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE 5: WIZARD -->
  <div id="page-wizard" class="page hidden">
    <div class="container">
      <div class="card wizardBox">
        <h2 id="wizardTitle">Wizard</h2>
        <div id="wizardMeta" class="note"></div>
        <div class="angleIndicator">Angle: <span id="angleValue"></span>°</div>

        <div class="entryRow">
          <div class="labelCol"><strong>DDM</strong></div>
          <div class="inputCol">
            <div class="input-with-next ddm-row">
              <span id="ddmSignPrefix" class="signPrefix">+</span>
              <input id="ddmInput" placeholder="Enter positive value only" inputmode="decimal" autocomplete="off">
              <button id="ddmNext" class="input-next small hidden">⏎</button>
            </div>
            <div id="ddmSignGroup" style="margin-top:6px; display:none;">
              <label style="margin-right:8px"><input type="radio" name="ddmSign" id="ddmPlus" value="+"> +</label>
              <label><input type="radio" name="ddmSign" id="ddmMinus" value="-"> −</label>
            </div>
            <div class="hint">Enter positive value only. DDM sign is set automatically based on angle (or choose sign at 0°).</div>
          </div>
        </div>

        <div class="entryRow">
          <div class="labelCol"><strong>SDM</strong></div>
          <div class="inputCol">
            <div class="input-with-next">
              <input id="sdmInput" placeholder="Enter positive value only" inputmode="decimal" autocomplete="off">
              <button id="sdmNext" class="input-next small hidden">⏎</button>
            </div>
            <div class="hint">Enter positive value only.</div>
          </div>
        </div>

        <div class="entryRow">
          <div class="labelCol"><strong>RF</strong></div>
          <div class="inputCol">
            <div class="input-with-next">
              <span class="signPrefix">-</span>
              <input id="rfInput" placeholder="Enter positive value only" inputmode="numeric" autocomplete="off">
              <button id="rfNext" class="input-next small hidden">➡</button>
            </div>
            <div class="hint">RF stored as negative. Enter the positive magnitude only.</div>
          </div>
        </div>

        <div class="progress" id="wizardProgress"></div>

        <div class="actions">
          <button id="prevAngle" class="btn small">Previous</button>
          <button id="nextAngle" class="btn small">Next</button>
          <button id="saveAngle" class="btn small">Save</button>
          <button id="finishWizard" class="btn primary">Finish TX and Back</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE RESULTS -->
  <div id="page-results" class="page hidden">
    <div class="container">
      <div class="card">
        <div id="resultsMeta" style="font-weight:800; margin-bottom:8px"></div>
        <h2>Results & Graphs</h2>

        <div class="actions">
          <button id="showTables" class="btn small">Toggle Tables</button>
          <button id="calcAll" class="btn small">Compute & Show Graphs</button>
        </div>

        <div id="tablesArea" class="hidden tablesArea" style="margin-top:10px"></div>

        <div id="plotsArea" class="hidden" style="margin-top:12px">
          <h3>TX1 — Present & Reference (DDM, SDM, RF)</h3>
          <div class="chartWrap"><canvas id="chart_tx1_all" style="width:100%;height:320px"></canvas></div>
          <div id="table_tx1_combined" class="tableCard" style="margin-top:12px"></div>

          <h3 style="margin-top:18px">TX2 — Present & Reference (DDM, SDM, RF)</h3>
          <div class="chartWrap"><canvas id="chart_tx2_all" style="width:100%;height:320px"></canvas></div>
          <div id="table_tx2_combined" class="tableCard" style="margin-top:12px"></div>
        </div>

        <pre id="resultsSummary" class="resultsSummary hidden"></pre>

        <div style="margin-top:12px;">
          <button id="exportCsvBtn" class="btn small">Export CSV</button>
          <button id="exportPdfBtn" class="btn small">Export PDF</button>
          <button id="exportImgsBtn" class="btn small">Export Graph Images</button>
        </div>
      </div>
    </div>
  </div>

  <script> const UPLOADED_FILE_URL = "/mnt/data/LLZ Field Reading.xls"; </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
